sudo: required
language: python
python:
- '3.6'
services:
- docker
- pip
os:
- linux
env:
  global:
  - DOCKER_IMAGE_NAME="happy-trash-backend"
  - DOCKER_HUB_ORG="alfaruqi26"
  - secure: EaUpVoqWFquMi3sgQt5rsFn6q6xwiqbTSnEH5jFm2lDRtUamnlqgj+D7v4aZ+/WF0qZ+h3s7XBsUZb/NkK4dbPNIrzPiJO2/2vwTkP4X+JF7FgPukRcfTCbwsuKlAp1qJO3oXdJ5INhxGTH1zGNV2pCJnP6eCCBRGYzGMC2ZVmQla0PHrRUGMoZyf+qiUcbfno6SrHx7cHs6ECkShIgQYAQ8vq/89lxtCMT2jDdxmuyXsubOxyJcY2Mc9IxzxSHlxlLNQIPLVBD7j//Q+BD/GVqXZJoAJIQJ8aTXDvfSvw/xUSq2UR2hH99hHiclYzJzWDT5m3qelnmVsQ0srqXaSlXxnG7IsDantm1/s0Ez+2KiiHz7wfA+WeWDujtTMeEOYkoFew4qBLK8kzmv0G4gSnbmJgFPHpjQGPyUeYrwrlAABE3eOfHIKSYPLLuIjZKSOEQWo+ZAjrNy0tr2LukRdtTE41Cey1AZ9n29phlv2FI//EcAUOeUaULMpP+Jn0nJ8INUx1goW4PeDjeYX+Fxu3QssvSIwx1fQadU6alxaYjhHKObH6aC1tvJZ0mQtj8DyKOFL3rDTC0kVfi35IF0JNIYfmZKsFco+GBH6ozbckqc7YL+6EY9TyR8BVMThNtIuI4aMmgXSpfZ1K7owT81WEgeP0ZvBCft9PRtnTOzX4I=
  - secure: YcIhmPlSTpnQKKrqhrqK1i5DHnZANsCqLHAoTFJRE2XkknnAppnyuSxCXeB6SXUxgdCjElg6OE2q893v28bvxCYUoEYycVFmUPArRyLW78qn32JHA2qTQ/UroZ1SIq7nDTRRI6NOgXKL5IgGiYVreem5tq93SRiwtXWS1GJzF7ytYfqyHU+7gG8u/Ajr7+LRxldWWZN0miIQuJedROLOrA7YdKNaCA6n5clgtZMsDGON1z6KdiNXVnWxgncr0GTkwYzruzQVQL6XezT+wFKlHP1rHvzNQ4iDkFdAuCXkScP3s5w2cKZ/7As24AhxsKq0CQq0zX3HqDV5sC2zQ1lVAgvjFJOgUKhk8EoRi+939XifoAtgGJ8K3ZcYZZI0LYTnMrlhy8zYDJ1FcothjBsoEzxUk2hfJI5TG2KKPbDUABphqwyN/nh1Ln+MPm37HnJZi6yCCPEW84P1uyr7ksyBj06NNCE9fBSPUuz7jzSlBgpsQyK9BVry5J+lqZoCuV7P/BCFe+ft+BxvCQXtFtBITI7GLcgZGIj5aY6JLGfaUoGqcjo43PshUKlscIdSr3/a/q7r3oktVpzBFWKwf7hMAn42FX2XIFTe34Gb6ZEQ1+/ZrqoNf8QpXW5EYYrw5OlA38ZcoUfYm42szjLjQB9xqQnUHVBic6KrWD2GYDogANo=
install:
- pip install -r requirements.txt
before_script:
- openssl aes-256-cbc -K $encrypted_38b87d0d3035_key -iv $encrypted_38b87d0d3035_iv
  -in deploy_rsa.enc -out deploy_rsa -d
- eval "$(ssh-agent -s)"
- chmod 600 deploy_rsa
- ssh-add deploy_rsa
- export DB_USER="${DB_USER}"
- export DB_PASSWORD="${DB_PASSWORD}"
- docker login -u "${DOCKER_USERNAME}" -p "${DOCKER_PASSWORD}"
script:
- sudo chmod +x deploy.sh
- sudo chmod 600 deploy_rsa
after_script:
- docker login -u "${DOCKER_USERNAME}" -p "${DOCKER_PASSWORD}"
- docker build -t ${DOCKER_HUB_ORG}/${DOCKER_IMAGE_NAME}:production-${TRAVIS_BUILD_ID}
  .
- docker push ${DOCKER_HUB_ORG}/${DOCKER_IMAGE_NAME}:production-${TRAVIS_BUILD_ID}
- docker tag ${DOCKER_HUB_ORG}/${DOCKER_IMAGE_NAME}:production-${TRAVIS_BUILD_ID}
  ${DOCKER_USERNAME}/${DOCKER_IMAGE_NAME}:v1
- docker login -u "${DOCKER_USERNAME}" -p "${DOCKER_PASSWORD}" && docker push ${DOCKER_HUB_ORG}/${DOCKER_IMAGE_NAME}:v1
- ssh-keyscan -H $SSH_IP >> ~/.ssh/known_hosts
- ssh -v -i deploy_rsa $SSH_USER@$SSH_IP DIR=$ROOT_DIR 'bash -s' < deploy.sh
before_install:
- openssl aes-256-cbc -K $encrypted_38b87d0d3035_key -iv $encrypted_38b87d0d3035_iv
  -in deploy_rsa.enc -out deploy_rsa -d
